{{ define "main" }}
{{ if eq .Type "post" }}{{ partial "structure/postheader" . }}{{ end }}

<section class="post">
  <article role="article" id="post" class="post-content {{ if eq .Type  "page"}} page {{ end }}">
    {{ if eq .Type "page"}}<h1>{{.Title}}</h1>{{ end }}
    {{ if eq .Type "post" }}
       <!--Thanks to https://github.com/kaushalmodi/ox-hugo/issues/178-->
       {{ $au := or .Params.author "alex" }}
       {{ $au_type := (printf "%T" $au) }}
       {{ $au_is_slice := (eq "[]string" $au_type) }}
       {{ if $au_is_slice }}
           {{ .Scratch.Set "__author_key" (index $au 0) }}
       {{ else }}
           {{ .Scratch.Set "__author_key" $au }}
       {{ end }}
       {{ $author := index .Site.Data.authors (.Scratch.Get "__author_key") }}
       {{ partial "structure/author.html" (index .Site.Data.authors $author.slug) }}
    {{ end }}
    {{ if not .Params.notoc }}
       {{ with .TableOfContents }}
           <div id="toc">
             <h1>{{ T "single_index" }}</h1>
             {{ . }}
           </div>
        {{ end }}
    {{ end }}
    {{ $ad := partial "structure/ad" . }}
    {{ replace .Content "<!--ad-->" $ad | safeHTML }}
    {{ if eq .Type "post" }}
       <p>{{ T "typo" | safeHTML }}</p>
    {{ end }}
    {{ partial "structure/share" . }}
    {{ partial "structure/cattags" . }}
    {{ partial "structure/nextprev" . }}
  </article>
  {{ if eq .Type "post" }}
     {{ partial "structure/comments" . }}
  {{ end }}
</section>
{{ with .Params.math }}
<script type="text/javascript" async
        src="/js/mj/MathJax.js?config=TeX-AMS_CHTML">
</script>
{{ end }}
{{ end }}
